<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exemple WebXR Cube</title>

  <!-- Charger Three.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>

<script>
  let scene, camera, renderer, cube;

  // Fonction d'initialisation de la scène
  async function init() {
    // Création de la scène Three.js
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87CEEB); // Fond bleu clair

    // Création de la caméra pour la VR
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    
    // Création du rendu WebGL
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Création de l'éclairage ambiant
    const light = new THREE.AmbientLight(0x404040); // Lumière douce
    scene.add(light);

    // Lumière directionnelle pour éclairer la scène
    const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(0, 1, 1).normalize();
    scene.add(directionalLight);

    // Création du cube (modèle rouge)
    const geometry = new THREE.BoxGeometry(0.1, 0.1, 0.1); // Dimensions du cube
    const material = new THREE.MeshStandardMaterial({ color: 0xff0000 }); // Cube rouge
    cube = new THREE.Mesh(geometry, material);
    cube.position.set(0, 0, -0.5); // Cube positionné devant la caméra
    scene.add(cube);

    // Vérification du support WebXR
    if ('xr' in navigator) {
      const session = await navigator.xr.requestSession('immersive-vr'); // Demander une session immersive VR
      renderer.xr.enabled = true;
      
      // Ajouter le rendu au DOM
      document.body.appendChild(renderer.domElement);

      // Demander une référence d'espace local
      const referenceSpace = await session.requestReferenceSpace('local');

      // Fonction de gestion des frames WebXR
      function onXRFrame(time, frame) {
        const session = frame.session;
        const pose = frame.getViewerPose(referenceSpace);

        if (pose) {
          // Rotation du cube pour animation
          cube.rotation.x += 0.01;
          cube.rotation.y += 0.01;
        }

        // Rendu de la scène
        renderer.render(scene, camera);
        session.requestAnimationFrame(onXRFrame);
      }

      // Lancer la session WebXR
      session.requestAnimationFrame(onXRFrame);
    } else {
      alert('WebXR n\'est pas supporté par ce navigateur.');
    }
  }

  // Lancer l'initialisation
  init();
</script>

</body>
</html>
